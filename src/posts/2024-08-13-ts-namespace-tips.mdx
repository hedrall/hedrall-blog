
# [Tips] TSの`namespace`宣言の使いどころ

## 名前空間とは？

## モジュール vs 名前空間

## TSでnamespaceを発生させる方法は二つ

1つめは、こちらの記事で解説されている、`モジュール名前空間オブジェクト`を利用することです。

[令和5年に知っているべきTypeScriptのnamespaceの知識](https://zenn.dev/uhyo/articles/ts-namespace-2023)

これは、`import * as Hoge from 'xxx';` した時に、`Hoge` に代入されるオブジェクトのことです。

これにより、特定のディレクトリをまとめて一つの`Hoge`という名前空間として扱うことができます。

2つめは、`namespace` 宣言を利用する方法です。

## namespace宣言を使った方がよい場面

結論として、あるEntity自体を名前空間として扱いたい場合は、`namespace`宣言を利用した方が自然な定義ができます。

例えば、`Artist`という名前空間に、`Album`を定義したいとします。
この場合、`Artist`は自体も一つのEntityとなりますが、`Album`を内包するnamespaceでもあります。

利用側では以下のようになります。

```typescript
import { Artist } from './Artist';
const album: Artist.Album = Artist.Album.create('title'); // 1
const artist: Artist = Artist.create('name', album);      // 2
```

1の左辺では`Artist`が`namespace`を表しており、右辺では`Artist`が`namespace`もしくは`Object(値)`を表しています。
一方で、2の左辺では`Artist`は`type(型)`を表しています。
なお、ArtistやAlbumといったEntityはコンパニオンオブジェクトパターンで実装されているものとします。

このような状況を2つの名前空間を利用して、どのように表現するかを考えます。

まず、モジュール名前空間オブジェクトを利用する場合は、以下のようになります。

```typescript
// ./artist/album.ts
export type _Album = { title: string; }
export const create = (title: string): _Album => ({ title });

// ./artist/index.ts
export * as Album from './album';
import type { _Album } from './album';
export type Album = _Album; // 1
export type _Artist = { name: string; album: _Album; };
export const create = (name: string, album: _Album): _Artist => ({ name, album });

// ./index.ts
import type { _Author } from './author';
export * as Author from './author';
export type Author = _Author; //
```

この方法のぎこちなさは、エンティティの内容の定義がファイルないでされるのに対し、名前空間はimportされた時点で定義されるため、
内容の定義と名前空間そのものの定義が分離する点にあります。
例えば、`./artist/album.ts` の中で、 `create` というファクトリ関数を定義しています。
一方で、Albumそのもの型は、名前空間のAlbumと同居させたいため、`./artist/index.ts`の`// 1`で部分のように再定義しています。

では、namespaceを利用する場合を考えます。

```typescript
// ./artist/album.ts
export type Album = { title: string; }
export namespace Album {
  export const create = (title: string): Album => ({ title });
}

// ./artist/index.ts
import { Album } from './album';
export type Artist = { name: string; album: Album; };
export namespace Artist {
  export import Album = Album; // 1. namespaceをそのままexportする方法
  export const create = (name: string, album: Album): Artist => ({ name, album });
}

// ./index.ts
export * from './artist';
```

このように、namespaceを利用する場合は、名前空間、型、値の定義は全て一つのファイルに納めることができるので、より自然な構造で定義することができます。

## 状況

> we recommended modules over namespaces in modern code.
> https://www.typescriptlang.org/docs/handbook/namespaces-and-modules.html

namespace宣言の最大の欠点は、グローバルに宣言されるということのようです。






